<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Advanced Student Dashboard</title>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />
  <!-- FontAwesome for icons -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* CSS Reset and base */
    *, *::before, *::after {
      box-sizing: border-box;
    }
    html, body {
      margin: 0; padding: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #f1f4ff;
      color: #2c3e50;
      height: 100%;
      user-select: none;
      overflow: hidden;
    }
    body.dark {
      background-color: #121212;
      color: #ddd;
    }
    #app {
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: 1fr;
      height: 100vh;
      width: 100vw;
      overflow: hidden;
      box-shadow: inset 0 0 20px #6676ff44;
    }
    @media (max-width: 600px) {
      #app {
        grid-template-columns: 1fr;
        grid-template-rows: 60px calc(100vh - 60px);
      }
    }
    /* Sidebar */
    #sidebar {
      background: #2B2F4A;
      color: #eee;
      display: flex;
      flex-direction: column;
      position: relative;
      z-index: 2;
      overflow-y: auto;
      transition: transform 0.3s ease;
    }
    #sidebar.hide {
      transform: translateX(-100%);
    }
    #sidebar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1.5rem 1.5rem 1rem 1.5rem;
      font-weight: 700;
      font-size: 1.6rem;
      letter-spacing: 1.1px;
      user-select:none;
      border-bottom: 1px solid #3b3f62;
    }
    #sidebar-header i.toggle-menu {
      cursor: pointer;
      font-size: 1.4rem;
      color: #6676ff;
      user-select:none;
    }
    #sidebar nav {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      padding-top: 1rem;
    }
    #sidebar nav button {
      background: transparent;
      border: none;
      color: #bbb;
      padding: 15px 25px;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      gap: 15px;
      align-items: center;
      border-left: 5px solid transparent;
      transition: all 0.3s ease;
      user-select:none;
    }
    #sidebar nav button svg, #sidebar nav button i.fa {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
      color: #bbb;
    }
    #sidebar nav button:hover,
    #sidebar nav button.active {
      color: #fff;
      background: #4853ff33;
      border-left-color: #6676ff;
      box-shadow: inset 4px 0 8px #6676ff88;
    }
    #sidebar nav button.active svg,
    #sidebar nav button.active i.fa {
      color: #6676ff;
    }
    /* Badge on notifications */
    #notifBadge {
      background: #ff3b3b;
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 1px 6px;
      border-radius: 12px;
      margin-left: auto;
      user-select:none;
    }
    /* Main content */
    #main {
      overflow-y: auto;
      background-color: #f9fafc;
      padding: 1.5rem 2rem;
      position: relative;
    }
    body.dark #main {
      background-color: #1a1a2e;
    }
    #main:focus {
      outline: none;
    }
    h2.section-title {
      font-weight: 600;
      margin-bottom: 1.2rem;
      font-size: 1.8rem;
      letter-spacing: 0.4px;
      color: #354364;
      user-select:none;
    }
    body.dark h2.section-title {
      color: #cfcfef;
    }
    /* Cards container */
    .cards {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(150px,1fr));
      gap: 1.3rem;
      margin-bottom: 3rem;
    }
    .card {
      background: white;
      padding: 1.3rem 1.6rem;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgb(102 118 255 / 0.16);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: default;
      user-select:none;
      transition: all 0.3s ease;
      position: relative;
    }
    .card:hover {
      box-shadow: 0 12px 20px rgb(102 118 255 / 0.4);
      transform: translateY(-6px);
    }
    body.dark .card {
      background: #28304d;
      box-shadow: 0 4px 20px rgb(102 118 255 / 0.5);
    }
    .card .icon {
      font-size: 2.8rem;
      color: #6676ff;
      margin-bottom: 0.3rem;
    }
    .card .value {
      font-size: 2rem;
      font-weight: 700;
      color: #1e253e;
    }
    body.dark .card .value {
      color: #c4c9ff;
    }
    .card .label {
      font-weight: 600;
      font-size: 0.9rem;
      margin-top: 0.3rem;
      color: #6676ff;
      user-select:none;
    }
    body.dark .card .label {
      color: #9aacff;
    }
    /* Tables */
    table {
      border-collapse: collapse;
      width: 100%;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 2px 12px rgb(102 118 255 / 0.12);
      background-color: white;
      font-size: 0.95rem;
      user-select:none;
    }
    body.dark table {
      background-color: #28304d;
      box-shadow: 0 4px 20px rgb(102 118 255 / 0.4);
    }
    thead tr {
      background: #6676ff;
      color: white;
      font-weight: 700;
      user-select:none;
    }
    tbody tr:nth-child(even) {
      background: #f6f9ff;
    }
    body.dark tbody tr:nth-child(even) {
      background: #34417044;
    }
    tbody tr:hover {
      background: #dde1ffdd;
      cursor: default;
    }
    body.dark tbody tr:hover {
      background: #5060ff44;
    }
    th, td {
      padding: 12px 18px;
      text-align: left;
      border-bottom: 1px solid #e1e5f2;
    }
    body.dark th, body.dark td {
      border-bottom: 1px solid #44507d88;
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    /* Forms and Controls */
    form {
      background: white;
      padding: 1.5rem 2rem;
      border-radius: 14px;
      box-shadow: 0 2px 10px rgb(102 118 255 / 0.16);
      margin-bottom: 2rem;
      max-width: 600px;
      user-select:none;
    }
    body.dark form {
      background: #28304d;
      box-shadow: 0 4px 20px rgb(102 118 255 / 0.4);
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.4rem;
      font-size: 1rem;
      color: #324571;
      user-select:none;
    }
    body.dark label {
      color: #b3b6ff;
    }
    input[type=text],
    input[type=email],
    input[type=number],
    input[type=date],
    select,
    textarea {
      width: 100%;
      padding: 0.55rem 0.75rem;
      font-size: 1rem;
      border-radius: 10px;
      border: 1.5px solid #c4c9ff77;
      margin-bottom: 1rem;
      transition: border-color 0.3s ease;
      color: #3b3f5c;
      font-family: 'Poppins', sans-serif;
      user-select:none;
    }
    body.dark input[type=text],
    body.dark input[type=email],
    body.dark input[type=number],
    body.dark input[type=date],
    body.dark select,
    body.dark textarea {
      background: #2b335e;
      color: #d1d6ffcc;
      border: 1.5px solid #6676ff88;
    }
    input[type=text]:focus,
    input[type=email]:focus,
    input[type=number]:focus,
    input[type=date]:focus,
    select:focus,
    textarea:focus {
      border-color: #6676ff;
      outline: none;
      background: white;
    }
    body.dark input[type=text]:focus,
    body.dark input[type=email]:focus,
    body.dark input[type=number]:focus,
    body.dark input[type=date]:focus,
    body.dark select:focus,
    body.dark textarea:focus {
      background: #3c467d;
    }
    button.btn {
      background: #6676ff;
      color: white;
      border: none;
      font-weight: 600;
      font-size: 1.1rem;
      padding: 0.65rem 2.2rem;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 4px 18px rgba(102,118,255,0.35);
      transition: background-color 0.3s ease;
      user-select:none;
    }
    button.btn:hover, button.btn:focus {
      background: #4e61f9;
      outline: none;
    }
    button.btn-secondary {
      background: #ddd;
      color: #444;
      box-shadow: none;
      margin-left: 1rem;
    }
    button.btn-secondary:hover, button.btn-secondary:focus {
      background: #bbb;
      outline: none;
    }
    /* Notifications area */
    #notification {
      position: fixed;
      bottom: 18px;
      right: 18px;
      background: #6676ff;
      padding: 14px 24px;
      color: white;
      border-radius: 16px;
      font-weight: 600;
      box-shadow: 0 6px 22px rgba(102,118,255,0.6);
      opacity: 0;
      pointer-events: none;
      user-select:none;
      transition: opacity 0.3s ease;
      z-index: 999999;
    }
    #notification.show {
      opacity: 1;
      pointer-events: auto;
    }
    body.dark #notification {
      background: #aabfff;
      color: #2b335e;
      box-shadow: 0 6px 22px rgba(170,187,255,0.6);
    }
    /* Chart containers */
    .chart-container {
      background: white;
      padding: 1rem 1.6rem 2rem 1.6rem;
      border-radius: 14px;
      box-shadow: 0 2px 12px rgb(102 118 255 / 0.15);
      margin-bottom: 3rem;
      max-width: 720px;
      user-select:none;
    }
    body.dark .chart-container {
      background: #28304d;
      box-shadow: 0 4px 20px rgb(102 118 255 / 0.4);
    }
    canvas {
      user-select:none;
    }

    /* Profile Photo */
    .profile-photo {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      background: #6676ff;
      font-size: 48px;
      font-weight: 700;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1rem;
      user-select:none;
      box-shadow: 0 4px 14px rgba(102, 118, 255, 0.3);
    }

    /* Calendar styles */
    #calendar {
      max-width: 620px;
      background: white;
      border-radius: 16px;
      padding: 1rem 1rem 1.3rem 1rem;
      box-shadow: 0 2px 16px rgb(102 118 255 / 0.18);
      font-family: 'Poppins', sans-serif;
      user-select:none;
    }
    body.dark #calendar {
      background: #28304d;
      box-shadow: 0 4px 20px rgb(102 118 255 / 0.4);
    }
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      margin-bottom: 1rem;
      user-select:none;
      color: #334175;
    }
    body.dark .calendar-header {
      color: #b3b6ff;
    }
    .calendar-header button {
      background: transparent;
      border: none;
      color: #6676ff;
      font-size: 1.3rem;
      font-weight: 900;
      cursor: pointer;
      width: 38px;
      height: 38px;
      transition: background-color 0.3s ease;
      border-radius: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select:none;
    }
    .calendar-header button:hover {
      background-color: #dbe1ff;
    }
    body.dark .calendar-header button:hover {
      background-color: #4052b1;
    }
    #calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      text-align: center;
      color: #8c90b2;
      font-weight: 700;
      font-size: 0.9rem;
      margin-bottom: 0.7rem;
      user-select:none;
    }
    body.dark #calendar-days {
      color: #abb0ffcc;
    }
    #calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      user-select:none;
    }
    .calendar-day {
      width: 38px;
      height: 38px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: 700;
      color: #4e5789;
      cursor: default;
      border-radius: 10px;
      user-select:none;
      transition: background-color 0.3s ease, color 0.3s ease;
      position: relative;
      font-size: 0.9rem;
    }
    body.dark .calendar-day {
      color: #abb0ffcc;
    }
    .calendar-day.today {
      background-color: #6676ff;
      color: white;
      box-shadow: 0 4px 14px #4957ebaa;
    }
    .calendar-day.event {
      border: 2px solid #4853ff;
      box-sizing: border-box;
      border-radius: 12px;
      font-weight: 800;
      color: #3041a1;
    }
    body.dark .calendar-day.event {
      border-color: #aabfff;
      color: #aabfff;
    }
    .calendar-day.other-month {
      color: #ccc;
      user-select:none;
    }
    .calendar-day:hover:not(.other-month) {
      background-color: #c9d0ff99;
      color: #3041a1;
      cursor: pointer;
      font-weight: 800;
    }
    body.dark .calendar-day:hover:not(.other-month) {
      background-color: #4860ffbb;
      color: #e4e7ff;
    }
    /* Accessibility improvements */
    button:focus-visible,
    input:focus-visible,
    select:focus-visible,
    textarea:focus-visible {
      outline: 3px solid #6676ff;
      outline-offset: 2px;
    }

    /* Responsive enhancements */
    @media (max-width: 600px) {
      #sidebar {
        position: fixed;
        top: 0; left: 0; bottom: 0;
        width: 260px;
        height: 100%;
        transform: translateX(-100%);
        background: #2B2F4A;
        box-shadow: 2px 0 12px #223366cc;
        z-index: 10;
      }
      #sidebar.show {
        transform: translateX(0);
      }
      #sidebar-header i.toggle-menu {
        display: block;
      }
      #sidebar nav button {
        font-size: 14px;
        padding: 14px 20px;
      }
      #main {
        padding: 1rem 1rem 3rem 1rem;
      }
      .overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        z-index: 5;
        backdrop-filter: blur(3px);
      }
      .overlay.show {
        display: block;
      }
    }

  </style>
</head>
<body>
  <div id="app" role="main" aria-label="Advanced Student Dashboard">
    <aside id="sidebar" aria-label="Primary Navigation" aria-hidden="false">
      <div id="sidebar-header">
        StudentDash
        <i class="fas fa-bars toggle-menu" tabindex="0" aria-label="Toggle menu" role="button"></i>
      </div>
      <nav role="navigation" aria-label="Main menu">
        <button class="active" data-panel="dashboard" aria-current="page"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
        <button data-panel="courses"><i class="fas fa-book"></i> Courses</button>
        <button data-panel="attendance"><i class="fas fa-user-check"></i> Attendance</button>
        <button data-panel="grades"><i class="fas fa-graduation-cap"></i> Grades</button>
        <button data-panel="assignments"><i class="fas fa-tasks"></i> Assignments</button>
        <button data-panel="calendar"><i class="fas fa-calendar-alt"></i> Calendar</button>
        <button data-panel="notifications"><i class="fas fa-bell"></i> Notifications <span id="notifBadge" aria-label="You have new notifications" hidden>0</span></button>
        <button data-panel="profile"><i class="fas fa-user-circle"></i> Profile</button>
        <button data-panel="settings"><i class="fas fa-cog"></i> Settings</button>
      </nav>
    </aside>
    <div class="overlay" tabindex="-1" aria-hidden="true"></div>
    <main id="main" tabindex="0" aria-live="polite" aria-atomic="true">
      <!-- Dashboard Panel -->
      <section id="dashboard" class="panel" aria-label="Dashboard Overview">
        <h2 class="section-title">Dashboard Overview</h2>
        <div class="cards" role="list" aria-label="Summary cards">
          <div class="card" role="listitem" tabindex="0" aria-label="Total courses enrolled in">
            <i class="fas fa-book icon" aria-hidden="true"></i>
            <div class="value" id="totalCoursesCard">0</div>
            <div class="label">Courses</div>
          </div>
          <div class="card" role="listitem" tabindex="0" aria-label="Total credits earned">
            <i class="fas fa-layer-group icon" aria-hidden="true"></i>
            <div class="value" id="creditsEarnedCard">0</div>
            <div class="label">Credits</div>
          </div>
          <div class="card" role="listitem" tabindex="0" aria-label="Overall attendance percentage">
            <i class="fas fa-user-check icon" aria-hidden="true"></i>
            <div class="value" id="attendancePercentCard">0%</div>
            <div class="label">Attendance</div>
          </div>
          <div class="card" role="listitem" tabindex="0" aria-label="Current GPA">
            <i class="fas fa-star icon" aria-hidden="true"></i>
            <div class="value" id="gpaCard">0.00</div>
            <div class="label">GPA</div>
          </div>
          <div class="card" role="listitem" tabindex="0" aria-label="Pending assignments">
            <i class="fas fa-tasks icon" aria-hidden="true"></i>
            <div class="value" id="assignmentsPendingCard">0</div>
            <div class="label">Pending Assignments</div>
          </div>
        </div>
        <div class="chart-container" aria-label="Attendance trends chart" role="region" tabindex="0">
          <canvas id="attendanceChart" aria-role="img" aria-label="Chart showing attendance trends"></canvas>
        </div>
        <div class="chart-container" aria-label="Grade distribution chart" role="region" tabindex="0">
          <canvas id="gradeChart" aria-role="img" aria-label="Chart showing grade distribution"></canvas>
        </div>
      </section>

      <!-- Courses Panel -->
      <section id="courses" class="panel" style="display:none" aria-label="Courses Management">
        <h2 class="section-title">Courses</h2>
        <form id="addCourseForm" aria-label="Add new course form" autocomplete="off" novalidate>
          <label for="courseCode">Course Code</label>
          <input type="text" id="courseCode" name="courseCode" placeholder="e.g. CS101" pattern="^[A-Za-z0-9\-]{2,10}$" required aria-required="true" aria-describedby="courseCodeHelp" />
          <small id="courseCodeHelp" style="color:#6676ff; font-size: 0.8rem;">Alphanumeric, 2-10 characters</small>
          <label for="courseName">Course Name</label>
          <input type="text" id="courseName" name="courseName" placeholder="Full course name" required aria-required="true" />
          <label for="courseCredits">Credits</label>
          <input type="number" id="courseCredits" name="courseCredits" min="1" max="10" placeholder="3" required aria-required="true" />
          <div style="margin-top: 1rem;">
            <button type="submit" class="btn" aria-label="Add course">Add Course <i class="fas fa-plus-circle"></i></button>
          </div>
        </form>
        <table aria-label="List of courses" id="coursesTable" tabindex="0" role="region" aria-live="polite">
          <thead>
            <tr><th scope="col">Code</th><th scope="col">Name</th><th scope="col">Credits</th><th scope="col">Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- Attendance Panel -->
      <section id="attendance" class="panel" style="display:none" aria-label="Attendance Tracking">
        <h2 class="section-title">Attendance</h2>
        <form id="markAttendanceForm" autocomplete="off" novalidate aria-label="Mark attendance form">
          <label for="attendanceCourse">Course</label>
          <select id="attendanceCourse" required aria-required="true" aria-describedby="attendanceCourseHelp"></select>
          <small id="attendanceCourseHelp" style="color:#6676ff; font-size: 0.8rem;">Select course</small>
          <label for="attendanceDate">Date</label>
          <input type="date" id="attendanceDate" required aria-required="true" />
          <label for="attendanceStatus">Status</label>
          <select id="attendanceStatus" required aria-required="true">
            <option value="present">Present</option>
            <option value="absent">Absent</option>
          </select>
          <div style="margin-top: 1rem;">
            <button type="submit" class="btn" aria-label="Record attendance">Mark Attendance <i class="fas fa-check-circle"></i></button>
          </div>
        </form>
        <table aria-label="Attendance records" id="attendanceTable" tabindex="0" role="region" aria-live="polite">
          <thead>
            <tr><th scope="col">Course</th><th scope="col">Date</th><th scope="col">Status</th><th scope="col">Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- Grades Panel -->
      <section id="grades" class="panel" style="display:none" aria-label="Grades Management">
        <h2 class="section-title">Grades</h2>
        <form id="gradeForm" autocomplete="off" novalidate aria-label="Add or update grade form">
          <label for="gradeCourse">Course</label>
          <select id="gradeCourse" required aria-required="true" aria-describedby="gradeCourseHelp"></select>
          <small id="gradeCourseHelp" style="color:#6676ff; font-size: 0.8rem;">Select course</small>
          <label for="gradeValue">Grade (0 - 100)</label>
          <input type="number" id="gradeValue" min="0" max="100" step="0.01" required aria-required="true" placeholder="e.g. 85" />
          <div style="margin-top: 1rem;">
            <button type="submit" class="btn" aria-label="Submit grade">Submit Grade <i class="fas fa-upload"></i></button>
          </div>
        </form>
        <table aria-label="Grades table" id="gradesTable" tabindex="0" role="region" aria-live="polite">
          <thead>
            <tr><th scope="col">Course</th><th scope="col">Grade</th><th scope="col">Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- Assignments Panel -->
      <section id="assignments" class="panel" style="display:none" aria-label="Assignments Tracker">
        <h2 class="section-title">Assignments</h2>
        <form id="addAssignmentForm" autocomplete="off" novalidate aria-label="Add new assignment form">
          <label for="assignmentTitle">Title</label>
          <input type="text" id="assignmentTitle" required aria-required="true" placeholder="Assignment title" />
          <label for="assignmentCourse">Course</label>
          <select id="assignmentCourse" required aria-required="true" aria-describedby="assignmentCourseHelp"></select>
          <small id="assignmentCourseHelp" style="color:#6676ff; font-size: 0.8rem;">Select course</small>
          <label for="assignmentDueDate">Due Date</label>
          <input type="date" id="assignmentDueDate" required aria-required="true" />
          <div style="margin-top: 1rem;">
            <button type="submit" class="btn" aria-label="Add assignment">Add Assignment <i class="fas fa-plus-circle"></i></button>
          </div>
        </form>
        <table aria-label="Assignments list" id="assignmentsTable" tabindex="0" role="region" aria-live="polite">
          <thead>
            <tr><th scope="col">Title</th><th scope="col">Course</th><th scope="col">Due Date</th><th scope="col">Status</th><th scope="col">Actions</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- Calendar Panel -->
      <section id="calendar" class="panel" style="display:none" aria-label="Academic Calendar">
        <h2 class="section-title">Calendar</h2>
        <div id="calendar" role="grid" aria-readonly="true" aria-label="Academic calendar with events" tabindex="0"></div>
      </section>

      <!-- Notifications Panel -->
      <section id="notifications" class="panel" style="display:none" aria-label="Notifications Center">
        <h2 class="section-title">Notifications</h2>
        <div id="notificationsList" role="region" aria-live="polite" aria-atomic="true" style="max-width: 600px;"></div>
      </section>

      <!-- Profile Panel -->
      <section id="profile" class="panel" style="display:none" aria-label="Student Profile">
        <h2 class="section-title">Profile</h2>
        <div class="profile-photo" aria-label="Student initials or photo" id="profilePhoto">S</div>
        <form id="profileForm" autocomplete="off" novalidate aria-label="Edit profile form">
          <label for="profileName">Full Name</label>
          <input type="text" id="profileName" name="profileName" required aria-required="true" />
          <label for="profileEmail">Email</label>
          <input type="email" id="profileEmail" name="profileEmail" required aria-required="true" />
          <label for="profileMajor">Major</label>
          <input type="text" id="profileMajor" name="profileMajor" />
          <div style="margin-top: 1rem;">
            <button type="submit" class="btn" aria-label="Save profile">Save Profile <i class="fas fa-save"></i></button>
          </div>
        </form>
      </section>

      <!-- Settings Panel -->
      <section id="settings" class="panel" style="display:none" aria-label="Application Settings">
        <h2 class="section-title">Settings</h2>
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 1rem;">
          <label for="toggleDarkMode" style="font-weight: 600;">Dark Mode:</label>
          <label class="switch" aria-label="Toggle dark mode">
            <input type="checkbox" id="toggleDarkMode" aria-checked="false" />
            <span class="slider"></span>
          </label>
        </div>
        <div style="font-size: 0.9rem; color: #6676ff;">
          <p><strong>Export Data:</strong> Download your data as JSON to back it up or share.</p>
          <button id="exportDataBtn" class="btn" aria-label="Export data as JSON"><i class="fas fa-file-export"></i> Export Data</button>
        </div>
        <div style="font-size: 0.9rem; color: #6676ff; margin-top: 1rem;">
          <p><strong>Import Data:</strong> Upload a JSON file to restore your data.</p>
          <input type="file" id="importDataFile" accept="application/json" aria-label="Import data JSON file" />
        </div>
      </section>
    </main>
  </div>

  <div id="notification" role="alert" aria-live="assertive" aria-atomic="true"></div>

  <script>
  (function(){
    'use strict';

    // Elements
    const panels = document.querySelectorAll('.panel');
    const sidebar = document.getElementById('sidebar');
    const sidebarButtons = sidebar.querySelectorAll('nav button');
    const mainContent = document.getElementById('main');
    const notificationEl = document.getElementById('notification');
    const overlay = document.querySelector('.overlay');

    const STORAGE_KEYS = {
      COURSES: 'studentDashV2_courses',
      ATTENDANCE: 'studentDashV2_attendance',
      GRADES: 'studentDashV2_grades',
      ASSIGNMENTS: 'studentDashV2_assignments',
      PROFILE: 'studentDashV2_profile',
      SETTINGS: 'studentDashV2_settings',
      NOTIFICATIONS: 'studentDashV2_notifications',
    };

    let courses = [];
    let attendance = [];
    let grades = [];
    let assignments = [];
    let profile = {};
    let settings = { darkMode: false };
    let notifications = [];

    // Utility function: debounce
    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // Save to localStorage helper
    function saveData(key, data) {
      try{
        localStorage.setItem(key, JSON.stringify(data));
      } catch(e) {
        notify('Error saving data to local storage');
        console.error(e);
      }
    }

    // Load from localStorage helper
    function loadData(key){
      try {
        const json = localStorage.getItem(key);
        if(json) {
          return JSON.parse(json);
        }
        return null;
      } catch(e) {
        console.error(e);
        return null;
      }
    }

    // Show notification
    let notifTimer = null;
    function notify(message, duration=3500){
      if(notifTimer) clearTimeout(notifTimer);
      notificationEl.textContent = message;
      notificationEl.classList.add('show');
      notifTimer = setTimeout(() => {
        notificationEl.classList.remove('show');
      }, duration);
    }

    // Navigation: Show panel by ID
    function showPanel(id) {
      panels.forEach(p => p.style.display = 'none');
      const panel = document.getElementById(id);
      if(panel){ panel.style.display = 'block'; }
      sidebarButtons.forEach(btn => {
        let active = btn.dataset.panel === id;
        btn.classList.toggle('active', active);
        btn.setAttribute('aria-current', active ? 'page' : 'false');
      });
      mainContent.focus();
      updateAll();
      if(window.innerWidth < 601){
        hideSidebar();
      }
    }

    // Sidebar toggle for mobile
    function toggleSidebar(){
      if(sidebar.classList.contains('show')){
        hideSidebar();
      } else {
        showSidebar();
      }
    }
    function showSidebar(){
      sidebar.classList.add('show');
      overlay.classList.add('show');
      sidebar.setAttribute('aria-hidden', 'false');
      overlay.setAttribute('aria-hidden','false');
      // Trap focus inside sidebar
      trapFocus(sidebar);
    }
    function hideSidebar(){
      sidebar.classList.remove('show');
      overlay.classList.remove('show');
      sidebar.setAttribute('aria-hidden', 'true');
      overlay.setAttribute('aria-hidden','true');
      // Remove focus trap
      releaseFocus();
    }

    // Trap focus inside an element (mobile menu accessibility)
    let focusableElements = [];
    let firstFocusable = null;
    let lastFocusable = null;
    function trapFocus(element){
      focusableElements = element.querySelectorAll('a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex="0"]');
      if(focusableElements.length > 0){
        firstFocusable = focusableElements[0];
        lastFocusable = focusableElements[focusableElements.length-1];
        firstFocusable.focus();
        document.addEventListener('keydown', handleTrapFocus);
      }
    }
    function handleTrapFocus(e){
      if(e.key === 'Tab'){
        if(e.shiftKey){
          if(document.activeElement === firstFocusable){
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          if(document.activeElement === lastFocusable){
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      }
      if(e.key === 'Escape'){
        hideSidebar();
      }
    }
    function releaseFocus(){
      document.removeEventListener('keydown', handleTrapFocus);
    }

    // Keyboard handlers
    sidebar.querySelector('i.toggle-menu').addEventListener('click', toggleSidebar);
    sidebar.querySelector('i.toggle-menu').addEventListener('keydown', e => {
      if(e.key==='Enter' || e.key===' '){
        e.preventDefault();
        toggleSidebar();
      }
    });
    overlay.addEventListener('click', hideSidebar);

    // Bind sidebar buttons
    sidebarButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        showPanel(btn.dataset.panel);
      });
    });

    // Load data from localStorage
    function loadAll(){
      const loadedCourses = loadData(STORAGE_KEYS.COURSES);
      if(Array.isArray(loadedCourses)){
        courses = loadedCourses;
      }

      const loadedAttendance = loadData(STORAGE_KEYS.ATTENDANCE);
      if(Array.isArray(loadedAttendance)){
        attendance = loadedAttendance;
      }

      const loadedGrades = loadData(STORAGE_KEYS.GRADES);
      if(Array.isArray(loadedGrades)){
        grades = loadedGrades;
      }

      const loadedAssignments = loadData(STORAGE_KEYS.ASSIGNMENTS);
      if(Array.isArray(loadedAssignments)){
        assignments = loadedAssignments;
      }

      const loadedProfile = loadData(STORAGE_KEYS.PROFILE);
      if(loadedProfile && typeof loadedProfile === 'object'){
        profile = loadedProfile;
      }

      const loadedSettings = loadData(STORAGE_KEYS.SETTINGS);
      if(loadedSettings && typeof loadedSettings === 'object'){
        settings = loadedSettings;
      }

      const loadedNotif = loadData(STORAGE_KEYS.NOTIFICATIONS);
      if(Array.isArray(loadedNotif)){
        notifications = loadedNotif;
      }
    }
    // Save all data helper
    function saveAll(){
      saveData(STORAGE_KEYS.COURSES, courses);
      saveData(STORAGE_KEYS.ATTENDANCE, attendance);
      saveData(STORAGE_KEYS.GRADES, grades);
      saveData(STORAGE_KEYS.ASSIGNMENTS, assignments);
      saveData(STORAGE_KEYS.PROFILE, profile);
      saveData(STORAGE_KEYS.SETTINGS, settings);
      saveData(STORAGE_KEYS.NOTIFICATIONS, notifications);
    }

    // Update dashboard cards
    function updateDashboardCards(){
      document.getElementById('totalCoursesCard').textContent = courses.length;
      const totalCredits = courses.reduce((sum, c) => sum + (c.credits || 0), 0);
      document.getElementById('creditsEarnedCard').textContent = totalCredits;
      const totalAttendanceRecords = attendance.length;
      const totalPresent = attendance.filter(a => a.status === 'present').length;
      const attendancePercent = totalAttendanceRecords === 0 ? 0 : Math.round((totalPresent/totalAttendanceRecords)*100);
      document.getElementById('attendancePercentCard').textContent = attendancePercent + '%';

      // GPA Calculation weighted on credits
      let weightedPoints = 0;
      let totalCreditPoints = 0;
      grades.forEach(g => {
        const course = courses.find(c => c.code === g.course);
        if(course){
          const gp = gradeToGPA(g.grade);
          weightedPoints += gp * course.credits;
          totalCreditPoints += course.credits;
        }
      });
      const gpa = totalCreditPoints === 0 ? 0 : (weightedPoints/totalCreditPoints);
      document.getElementById('gpaCard').textContent = gpa.toFixed(2);

      const pendingAssignments = assignments.filter(a => !a.completed && new Date(a.dueDate) >= new Date()).length;
      document.getElementById('assignmentsPendingCard').textContent = pendingAssignments;

      // Update notifications badge
      const notifBadge = document.getElementById('notifBadge');
      if(notifications.length > 0) {
        notifBadge.textContent = notifications.length.toString();
        notifBadge.hidden = false;
      } else {
        notifBadge.hidden = true;
      }
    }

    // Grade (0-100) to GPA scale 0-4 (simplified)
    function gradeToGPA(grade){
      if(grade >= 90) return 4.0;
      if(grade >= 80) return 3.0;
      if(grade >= 70) return 2.0;
      if(grade >= 60) return 1.0;
      return 0.0;
    }

    // Helper to create element with attrs and text
    function createElm(tag, attrs={}, text=''){
      const el = document.createElement(tag);
      for(const [k,v] of Object.entries(attrs)) {
        el.setAttribute(k,v);
      }
      if(text) el.textContent = text;
      return el;
    }


    // Update Courses Table
    function updateCoursesTable(){
      const tbody = document.querySelector('#coursesTable tbody');
      tbody.innerHTML = '';
      if(courses.length === 0){
        const row = createElm('tr');
        const td = createElm('td', {colspan:'4', style:'text-align:center; font-style:italic;'}, 'No courses added yet.');
        row.appendChild(td);
        tbody.appendChild(row);
        return;
      }
      courses.forEach(c => {
        const row = createElm('tr');
        row.appendChild(createElm('td', {scope:'row'}, c.code));
        row.appendChild(createElm('td', {}, c.name));
        row.appendChild(createElm('td', {}, c.credits.toString()));
        const tdActions = createElm('td');
        const removeBtn = createElm('button', {class:'btn-secondary', 'aria-label': `Remove course ${c.code}`}, 'Remove');
        removeBtn.addEventListener('click', () => {
          if(confirm(`Remove course ${c.code}? This will also remove related attendance, grades, and assignments.`)){
            removeCourse(c.code);
          }
        });
        tdActions.appendChild(removeBtn);
        row.appendChild(tdActions);
        tbody.appendChild(row);
      });
    }
    // Remove course and dependencies
    function removeCourse(code){
      courses = courses.filter(c => c.code !== code);
      attendance = attendance.filter(a => a.course !== code);
      grades = grades.filter(g => g.course !== code);
      assignments = assignments.filter(a => a.course !== code);
      saveAll();
      updateCoursesTable();
      updateCourseSelects();
      updateAttendanceTable();
      updateGradesTable();
      updateAssignmentsTable();
      updateDashboardCards();
      notify(`Course ${code} removed.`);
    }

    // Update course selection dropdowns (attendance, grade, assignment forms)
    function updateCourseSelects(){
      const selects = [document.getElementById('attendanceCourse'), document.getElementById('gradeCourse'), document.getElementById('assignmentCourse')];
      selects.forEach(sel => {
        sel.innerHTML = '';
        if(courses.length === 0){
          const nodataOption = createElm('option', {disabled:true, selected:true}, 'No courses available');
          sel.appendChild(nodataOption);
          sel.disabled = true;
        } else {
          sel.disabled = false;
          const placeholderOption = createElm('option', {disabled:true, selected:true, value:''}, 'Select course');
          sel.appendChild(placeholderOption);
          courses.forEach(c => {
            const option = createElm('option', {value: c.code}, `${c.code} - ${c.name}`);
            sel.appendChild(option);
          });
        }
      });
    }

    // Add Course form handler
    document.getElementById('addCourseForm').addEventListener('submit', e => {
      e.preventDefault();
      const codeInput = e.target.courseCode;
      const nameInput = e.target.courseName;
      const creditsInput = e.target.courseCredits;
      // Validation regex for alphanumeric with dash = 2-10 chars
      const courseCodeRegex = /^[A-Za-z0-9\-]{2,10}$/;
      const code = codeInput.value.trim().toUpperCase();
      if(!courseCodeRegex.test(code)){
        notify('Course code must be alphanumeric 2-10 characters.');
        codeInput.focus();
        return;
      }
      const name = nameInput.value.trim();
      const credits = Number(creditsInput.value);
      if(!name || !credits || credits <1 || credits>10){
        notify('Please enter valid course name and credits (1-10).');
        return;
      }
      if(courses.find(c=>c.code === code)){
        notify('Course code already exists.');
        codeInput.focus();
        return;
      }
      courses.push({code, name, credits});
      saveAll();
      updateCoursesTable();
      updateCourseSelects();
      e.target.reset();
      notify(`Course ${code} added.`);
      updateDashboardCards();
    });

    // Attendance Table Update
    function updateAttendanceTable(){
      const tbody = document.querySelector('#attendanceTable tbody');
      tbody.innerHTML = '';
      if(attendance.length === 0){
        const row = createElm('tr');
        const td = createElm('td', {colspan:'4', style:'text-align:center; font-style:italic;'}, 'No attendance records.');
        row.appendChild(td);
        tbody.appendChild(row);
        return;
      }
      // Sort descending by date
      const sorted = [...attendance].sort((a,b)=>(new Date(b.date))-(new Date(a.date)));
      sorted.forEach(rec => {
        const row = createElm('tr');
        let courseName = (courses.find(c=>c.code===rec.course)||{}).name || rec.course;
        row.appendChild(createElm('td', {}, `${rec.course} - ${courseName}`));
        row.appendChild(createElm('td', {}, rec.date));
        const statusTd = createElm('td', {}, '');
        const span = createElm('span', {style:`color:${rec.status==='present'?'green':'red'}; font-weight:600;`}, rec.status.charAt(0).toUpperCase()+rec.status.slice(1));
        statusTd.appendChild(span);
        row.appendChild(statusTd);
        // Remove button for attendance record
        const tdActions = createElm('td');
        const removeBtn = createElm('button', {class:'btn-secondary', 'aria-label': `Remove attendance for ${rec.course} on ${rec.date}`}, "Remove");
        removeBtn.addEventListener('click', () => {
          if(confirm(`Remove attendance for ${rec.course} on ${rec.date}?`)){
            attendance = attendance.filter(a => !(a.course===rec.course && a.date===rec.date));
            saveAll();
            updateAttendanceTable();
            updateDashboardCards();
            notify(`Attendance record removed.`);
          }
        });
        tdActions.appendChild(removeBtn);
        row.appendChild(tdActions);
        tbody.appendChild(row);
      });
    }
    // Handle adding attendance record
    document.getElementById('markAttendanceForm').addEventListener('submit', e=>{
      e.preventDefault();
      const course = e.target.attendanceCourse.value;
      const date = e.target.attendanceDate.value;
      const status = e.target.attendanceStatus.value;
      if(!course){
        notify('Please select a course.');
        return;
      }
      if(!date){
        notify('Please select a date.');
        return;
      }
      if(!['present','absent'].includes(status)){
        notify('Please select attendance status.');
        return;
      }
      // Check existing
      const existingIndex = attendance.findIndex(a=>a.course===course && a.date===date);
      if(existingIndex >=0){
        attendance[existingIndex].status = status;
        notify(`Attendance updated for ${course} on ${date}`);
      } else {
        attendance.push({course, date, status});
        notify(`Attendance marked for ${course} on ${date}`);
      }
      saveAll();
      e.target.reset();
      updateAttendanceTable();
      updateDashboardCards();
      updateAttendanceChart();
    });

    // Grades Table Update
    function updateGradesTable(){
      const tbody = document.querySelector('#gradesTable tbody');
      tbody.innerHTML = '';
      if(grades.length === 0){
        const row = createElm('tr');
        const td = createElm('td', {colspan:'3', style:'text-align:center; font-style:italic;'}, 'No grades entered.');
        row.appendChild(td);
        tbody.appendChild(row);
        return;
      }
      grades.forEach(g => {
        const row = createElm('tr');
        const courseName = (courses.find(c=>c.code===g.course)||{}).name || g.course;
        row.appendChild(createElm('td', {}, `${g.course} - ${courseName}`));
        row.appendChild(createElm('td', {}, g.grade.toFixed(2)));
        const tdActions = createElm('td');
        const removeBtn = createElm('button', {class:'btn-secondary', 'aria-label': `Remove grade for ${g.course}`}, 'Remove');
        removeBtn.addEventListener('click', () => {
          if(confirm(`Remove grade for ${g.course}?`)){
            grades = grades.filter(gr=>gr.course!==g.course);
            saveAll();
            updateGradesTable();
            updateDashboardCards();
            updateGradeChart();
            notify('Grade removed.');
          }
        });
        tdActions.appendChild(removeBtn);
        row.appendChild(tdActions);
        tbody.appendChild(row);
      });
    }
    // Grades form
    document.getElementById('gradeForm').addEventListener('submit', e=>{
      e.preventDefault();
      const course = e.target.gradeCourse.value;
      const gradeRaw = e.target.gradeValue.value;
      const grade = Number(gradeRaw);
      if(!course){
        notify('Please select a course.');
        return;
      }
      if(isNaN(grade) || grade < 0 || grade > 100){
        notify('Grade must be between 0 and 100.');
        return;
      }
      const index = grades.findIndex(g=>g.course===course);
      if(index >= 0){
        grades[index].grade = grade;
        notify(`Grade updated for ${course}.`);
      } else {
        grades.push({course, grade});
        notify(`Grade added for ${course}.`);
      }
      saveAll();
      e.target.reset();
      updateGradesTable();
      updateDashboardCards();
      updateGradeChart();
    });

    // Assignments Table Update
    function updateAssignmentsTable(){
      const tbody = document.querySelector('#assignmentsTable tbody');
      tbody.innerHTML = '';
      if(assignments.length === 0){
        const row = createElm('tr');
        const td = createElm('td', {colspan:'5', style:'text-align:center; font-style:italic;'}, 'No assignments added.');
        row.appendChild(td);
        tbody.appendChild(row);
        return;
      }
      assignments.sort((a,b) => new Date(a.dueDate) - new Date(b.dueDate) );
      assignments.forEach(a => {
        const row = createElm('tr');
        row.appendChild(createElm('td', {}, a.title));
        const courseName = (courses.find(c=>c.code===a.course)||{}).name || a.course;
        row.appendChild(createElm('td', {}, `${a.course} - ${courseName}`));
        row.appendChild(createElm('td', {}, a.dueDate));
        row.appendChild(createElm('td', {}, a.completed ? 'Completed' : 'Pending'));
        const tdActions = createElm('td');
        const toggleBtn = createElm('button', {class:'btn-secondary', 'aria-label': `${a.completed ? 'Mark pending' : 'Mark completed'} assignment ${a.title}`}, a.completed ? 'Mark Pending' : 'Mark Completed');
        toggleBtn.addEventListener('click', () => {
          a.completed = !a.completed;
          saveAll();
          updateAssignmentsTable();
          updateDashboardCards();
          notify(`Assignment "${a.title}" marked ${a.completed ? 'completed' : 'pending'}.`);
        });
        const removeBtn = createElm('button', {class:'btn-secondary', style:'margin-left:8px;', 'aria-label': `Remove assignment ${a.title}`}, 'Remove');
        removeBtn.addEventListener('click', () => {
          if(confirm(`Remove assignment "${a.title}"?`)){
            assignments = assignments.filter(asn => asn !== a);
            saveAll();
            updateAssignmentsTable();
            updateDashboardCards();
            notify(`Assignment "${a.title}" removed.`);
          }
        });
        tdActions.appendChild(toggleBtn);
        tdActions.appendChild(removeBtn);
        row.appendChild(tdActions);
        tbody.appendChild(row);
      });
    }
    // Add assignment
    document.getElementById('addAssignmentForm').addEventListener('submit', e=>{
      e.preventDefault();
      const title = e.target.assignmentTitle.value.trim();
      const course = e.target.assignmentCourse.value;
      const dueDate = e.target.assignmentDueDate.value;
      if(!title || !course || !dueDate){
        notify('Please complete all assignment fields.');
        return;
      }
      assignments.push({title, course, dueDate, completed:false});
      saveAll();
      e.target.reset();
      updateAssignmentsTable();
      updateDashboardCards();
      notify(`Assignment added: "${title}"`);
    });

    // Profile Form Updates
    function updateProfileForm(){
      document.getElementById('profileName').value = profile.name || '';
      document.getElementById('profileEmail').value = profile.email || '';
      document.getElementById('profileMajor').value = profile.major || '';
      updateProfilePhoto();
    }
    function updateProfilePhoto(){
      const photoEl = document.getElementById('profilePhoto');
      if(profile.name && profile.name.length > 0){
        const initials = profile.name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0,2);
        photoEl.textContent = initials;
      } else {
        photoEl.textContent = 'S';
      }
    }
    document.getElementById('profileForm').addEventListener('submit', e=>{
      e.preventDefault();
      const name = e.target.profileName.value.trim();
      const email = e.target.profileEmail.value.trim();
      const major = e.target.profileMajor.value.trim();
      if(!name || !email){
        notify('Please provide valid name and email.');
        return;
      }
      profile.name = name;
      profile.email = email;
      profile.major = major;
      saveAll();
      updateProfilePhoto();
      notify('Profile saved.');
    });

    // Dark mode toggle & apply settings
    const toggleDarkMode = document.getElementById('toggleDarkMode');
    toggleDarkMode.addEventListener('change', e=>{
      settings.darkMode = e.target.checked;
      applySettings();
      saveAll();
    });
    function applySettings(){
      if(settings.darkMode){
        document.body.classList.add('dark');
        toggleDarkMode.setAttribute('aria-checked','true');
        toggleDarkMode.checked = true;
      } else {
        document.body.classList.remove('dark');
        toggleDarkMode.setAttribute('aria-checked','false');
        toggleDarkMode.checked = false;
      }
    }

    // Calendar implementation - displays current month with events
    const calendarEl = document.getElementById('calendar');
    let calendarCurrentDate = new Date();
    function buildCalendar(){
      calendarEl.innerHTML = '';
      const year = calendarCurrentDate.getFullYear();
      const month = calendarCurrentDate.getMonth();

      // Header with month navigation
      const header = createElm('div', {class:'calendar-header'});
      const prevBtn = createElm('button', {ariaLabel:'Previous month', tabindex:'0'}, '〈');
      const nextBtn = createElm('button', {ariaLabel:'Next month', tabindex:'0'}, '〉');
      const monthName = calendarCurrentDate.toLocaleString('default', {month:'long', year:'numeric'});
      const titleEl = createElm('div', {}, monthName);
      header.appendChild(prevBtn);
      header.appendChild(titleEl);
      header.appendChild(nextBtn);
      calendarEl.appendChild(header);

      // Days of week names
      const daysRow = createElm('div', {id:'calendar-days'});
      ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].forEach(dayName=>{
        daysRow.appendChild(createElm('div', {}, dayName));
      });
      calendarEl.appendChild(daysRow);

      // Grid with days
      const grid = createElm('div', {id:'calendar-grid'});

      // First day of month and offset days
      const firstDay = new Date(year, month, 1);
      const startDay = firstDay.getDay();
      // Days in month
      const daysInMonth = new Date(year, month+1, 0).getDate();

      // Days from previous month
      for(let i=0; i < startDay; i++){
        const dayDiv = createElm('div', {class:'calendar-day other-month'}, '');
        grid.appendChild(dayDiv);
      }

      // Today in YYYY-MM-DD for highlight
      const today = new Date();
      const todayStr = today.toISOString().slice(0,10);

      // Render days with possible events
      for(let day=1; day<=daysInMonth; day++){
        const dayDate = new Date(year, month, day);
        const dayStr = dayDate.toISOString().slice(0,10);
        const dayDiv = createElm('div', {class:'calendar-day'}, day.toString());

        if(dayStr === todayStr){
          dayDiv.classList.add('today');
        }
        // Check for assignment due for day
        if(assignments.some(a=>a.dueDate===dayStr && !a.completed)){
          dayDiv.classList.add('event');
          dayDiv.title = 'Assignment due';
          dayDiv.setAttribute('aria-label', `Assignment due on ${dayStr}`);
        }
        grid.appendChild(dayDiv);
      }

      calendarEl.appendChild(grid);

      prevBtn.addEventListener('click', ()=>{
        calendarCurrentDate = new Date(year, month-1);
        buildCalendar();
      });
      nextBtn.addEventListener('click', ()=>{
        calendarCurrentDate = new Date(year, month+1);
        buildCalendar();
      });
    }

    // Notifications list update
    const notificationsListEl = document.getElementById('notificationsList');
    function updateNotificationsList(){
      notificationsListEl.innerHTML = '';
      if(notifications.length === 0){
        notificationsListEl.textContent = 'No notifications.';
        return;
      }
      notifications.forEach(n=>{
        const div = createElm('div', {style: 'background: #6676ff; color: white; padding: 10px 16px; margin-bottom: 1rem; border-radius: 14px; user-select:none; font-weight: 600;'});
        div.textContent = n.message;
        notificationsListEl.appendChild(div);
      });
    }

    // Charts - Chart.js usage for attendance and grades
    let attendanceChart = null;
    let gradeChart = null;
    function updateAttendanceChart(){
      if(!attendanceChart){
        const ctx = document.getElementById('attendanceChart').getContext('2d');
        attendanceChart = new Chart(ctx, {
          type: 'line',
          data: { labels: [], datasets: [] },
          options: {
            responsive: true,
            aspectRatio: 2.5,
            plugins: {
              legend: { display: true, position: 'top' },
              tooltip: { enabled: true },
            },
            scales: {
              y: { min:0, max: 100, title: {display:true, text:'Attendance %'} },
              x: {title: {display:true, text:'Courses'} }
            }
          }
        });
      }
      const labels = courses.map(c => c.code);
      const data = labels.map(code =>{
        let recs = attendance.filter(a => a.course === code);
        if(recs.length === 0) return 0;
        const present = recs.filter(r => r.status==='present').length;
        return Math.round(present / recs.length * 100);
      });
      attendanceChart.data.labels = labels;
      attendanceChart.data.datasets = [{
        label: 'Attendance %',
        data,
        backgroundColor: 'rgba(102, 118, 255, 0.35)',
        borderColor: '#6676ff',
        fill: true,
        tension: 0.3,
        pointRadius: 6,
        pointHoverRadius: 8,
      }];
      attendanceChart.update();
    }
    function updateGradeChart(){
      if(!gradeChart){
        const ctx = document.getElementById('gradeChart').getContext('2d');
        gradeChart = new Chart(ctx, {
          type: 'bar',
          data: { labels: [], datasets: [] },
          options: {
            responsive: true,
            aspectRatio: 3,
            indexAxis: 'y',
            plugins: {
              legend: { display: false },
              tooltip: { enabled: true }
            },
            scales: {
              x: {min: 0, max: 100, title: {display:true, text:'Grade (%)'} },
              y: {title: {display:true, text:'Course'} }
            }
          }
        });
      }
      const labels = grades.map(g => g.course);
      const data = grades.map(g => g.grade);
      gradeChart.data.labels = labels;
      gradeChart.data.datasets = [{
        label: 'Grade %',
        data,
        backgroundColor: '#6676ff',
        borderRadius: 6,
        barPercentage: 0.7,
      }];
      gradeChart.update();
    }

    // Update all screens & charts
    function updateAll(){
      updateDashboardCards();
      updateCoursesTable();
      updateCourseSelects();
      updateAttendanceTable();
      updateGradesTable();
      updateAssignmentsTable();
      updateProfileForm();
      applySettings();
      updateNotificationsList();
      buildCalendar();
      updateAttendanceChart();
      updateGradeChart();
    }

    // Export data button (JSON download)
    document.getElementById('exportDataBtn').addEventListener('click', () => {
      const data = {
        courses, attendance, grades, assignments, profile, settings, notifications
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'student-dashboard-data.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      notify('Data exported as JSON.');
    });

    // Import data input handler
    document.getElementById('importDataFile').addEventListener('change', e => {
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = function(event){
        try {
          const imported = JSON.parse(event.target.result);
          if(imported && typeof imported === 'object'){
            courses = Array.isArray(imported.courses) ? imported.courses : courses;
            attendance = Array.isArray(imported.attendance) ? imported.attendance : attendance;
            grades = Array.isArray(imported.grades) ? imported.grades : grades;
            assignments = Array.isArray(imported.assignments) ? imported.assignments : assignments;
            profile = typeof imported.profile === 'object' ? imported.profile : profile;
            settings = typeof imported.settings === 'object' ? imported.settings : settings;
            notifications = Array.isArray(imported.notifications) ? imported.notifications : notifications;
            saveAll();
            updateAll();
            notify('Data imported successfully. Reloading dashboard.');
          } else {
            notify('Invalid data structure in imported JSON.');
          }
        } catch(e) {
          notify('Error parsing JSON file.');
          console.error(e);
        }
      };
      reader.readAsText(file);
      e.target.value = ''; // reset input
    });

    // Initialization
    function init(){
      loadAll();
      showPanel('dashboard');
      updateAll();
    }

    // Save on unload
    window.addEventListener('beforeunload', saveAll);

    // Keyboard shortcuts for accessibility (Alt+D - Dashboard, Alt+C - Courses etc)
    window.addEventListener('keydown', e=>{
      if(e.altKey && !e.shiftKey && !e.ctrlKey){
        switch(e.key.toLowerCase()){
          case 'd': showPanel('dashboard'); e.preventDefault(); break;
          case 'c': showPanel('courses'); e.preventDefault(); break;
          case 'a': showPanel('attendance'); e.preventDefault(); break;
          case 'g': showPanel('grades'); e.preventDefault(); break;
          case 's': showPanel('assignments'); e.preventDefault(); break;
          case 'k': showPanel('calendar'); e.preventDefault(); break;
          case 'n': showPanel('notifications'); e.preventDefault(); break;
          case 'p': showPanel('profile'); e.preventDefault(); break;
          case 't': showPanel('settings'); e.preventDefault(); break;
        }
      }
    });

    init();

  })();
  </script>
</body>
</html>

